Here's a step-by-step guide to setting up Site-to-Site VPN between Azure and AWS, including architecture, configuration steps on both sides, and important tips.

ğŸŒ Overview: Azureâ€“AWS Site-to-Site VPN
A Site-to-Site VPN connects Azure Virtual Network (VNet) with AWS Virtual Private Cloud (VPC) over a secure IPsec tunnel.

ğŸ”’ Use Case Examples:
Hybrid cloud connectivity

DR/Failover between AWS & Azure

Multi-cloud applications

ğŸ§­ Architecture Diagram (Simplified)
less
Copy
Edit
[ Azure VNet ]
     |
[Azure VPN Gateway]
     â‡„ IPsec VPN Tunnel â‡„
[AWS Virtual Private Gateway]
     |
[ AWS VPC ]
ğŸ“ Pre-requisites
Requirement	Azure	AWS
VNet created	âœ…	âœ…
Subnets assigned	âœ…	âœ…
VPN Gateway	âœ…	âœ…
Public IP for Gateway	âœ…	âœ…
Routing enabled	âœ…	âœ…

âœ… Step-by-Step Configuration
ğŸ”· Step 1: Create a VPC and VPN Gateway on AWS
Create VPC

CIDR: 10.1.0.0/16

Subnet: 10.1.1.0/24

Create a Virtual Private Gateway

AWS Console â†’ VPC â†’ VPN â†’ Virtual Private Gateways â†’ Create

Name: aws-vgw

Attach to the VPC

Create Customer Gateway

Go to VPC â†’ VPN â†’ Customer Gateways â†’ Create

Name: azure-cgw

IP address: Azure VPN Gateway public IP (you will get this later)

Routing: Static or Dynamic (BGP)

Create VPN Connection

Type: Site-to-Site

Virtual Private Gateway: select aws-vgw

Customer Gateway: select azure-cgw

Routing: Static (use Azure subnet) or Dynamic (use BGP ASN)

Once created, download the VPN configuration (choose Generic or Cisco format)

ğŸ”· Step 2: Create VNet and VPN Gateway on Azure
Create Resource Group (if needed)

bash
Copy
Edit
az group create --name azure-vpn-rg --location eastus
Create Virtual Network

bash
Copy
Edit
az network vnet create \
  --resource-group azure-vpn-rg \
  --name azure-vnet \
  --address-prefix 10.0.0.0/16 \
  --subnet-name GatewaySubnet \
  --subnet-prefix 10.0.255.0/27
ğŸ”” Important: You must name the subnet GatewaySubnet.

Create Public IP for Gateway

bash
Copy
Edit
az network public-ip create \
  --resource-group azure-vpn-rg \
  --name azure-vpn-gw-ip \
  --allocation-method Dynamic
Create VPN Gateway

bash
Copy
Edit
az network vnet-gateway create \
  --name azure-vpn-gateway \
  --public-ip-address azure-vpn-gw-ip \
  --resource-group azure-vpn-rg \
  --vnet azure-vnet \
  --gateway-type Vpn \
  --vpn-type RouteBased \
  --sku VpnGw1 \
  --no-wait \
  --location eastus
âŒ› This takes ~20â€“30 mins.

ğŸ”· Step 3: Create Local Network Gateway (to represent AWS)
Use the public IP from AWS VPN configuration and the AWS VPC CIDR:

bash
Copy
Edit
az network local-gateway create \
  --resource-group azure-vpn-rg \
  --name aws-local-gw \
  --gateway-ip-address <AWS_VPN_PUBLIC_IP> \
  --local-address-prefixes 10.1.0.0/16
ğŸ”· Step 4: Create Connection (Azure to AWS)
bash
Copy
Edit
az network vpn-connection create \
  --name azure-to-aws-vpn \
  --resource-group azure-vpn-rg \
  --vnet-gateway1 azure-vpn-gateway \
  --shared-key 'YourPresharedKey123' \
  --local-gateway2 aws-local-gw \
  --location eastus
Use the pre-shared key from AWS VPN configuration.

ğŸ”· Step 5: Update AWS VPN with Azure Gateway Info
If not done earlier:

Go to Customer Gateway

Enter the Azure VPN public IP

Update VPN Connection on AWS side with:

Azure public IP

Pre-shared key

Static route: Azure subnet 10.0.0.0/16

ğŸ”· Step 6: Update Route Tables
On Azure:
Add route to AWS subnet 10.1.0.0/16 via VPN Gateway

On AWS:
Edit VPC route table â†’ Route to 10.0.0.0/16 via Virtual Private Gateway

ğŸ”§ Step 7: Test the Connectivity
Deploy VM in each cloud (Azure & AWS)

Ensure NSGs & Security Groups allow ICMP or TCP (like SSH/HTTP)

Ping or SSH from Azure VM to AWS VM and vice versa

ğŸ“Š Summary Table
Component	Azure	AWS
VNet / VPC	âœ… 10.0.0.0/16	âœ… 10.1.0.0/16
VPN Gateway	âœ…	âœ…
Public IP	âœ…	âœ…
VPN Tunnel	IPsec Site-to-Site	
Routing	UDR	Route Table
Shared Key	Set manually	Set manually

ğŸ” Tips & Best Practices
Use BGP for dynamic routing in production.

Monitor VPN using Azure Monitor and CloudWatch.

Use Network Watcher in Azure for diagnostics.

Always use strong pre-shared keys.

Consider using ExpressRoute or Direct Connect for high-throughput production workloads.
